# Forex Signal Agent

Forex Signal Agent — это асинхронное приложение на Python, предназначенное для автоматического мониторинга валютных пар на рынке Форекс и отправки торговых сигналов через Telegram-бота. Агент анализирует рыночные данные с использованием технических индикаторов (EMA, MACD, RSI, ADX) и отправляет уведомления о значимых событиях и торговых сигналах.

## Архитектура проекта

- **main.py**: Основной модуль приложения, содержащий логику основного цикла работы агента и бэктеста
- **config.py**: Управление конфигурацией приложения с поддержкой YAML и переменных окружения
- **analyzer.py**: Модуль анализа рыночных данных и обнаружения торговых сигналов
- **indicators.py**: Расчет технических индикаторов с использованием библиотеки TA-Lib
- **yahoo_finance_client.py**: Клиент для получения рыночных данных с Yahoo Finance
- **telegram_notifier.py**: Отправка уведомлений через Telegram-бота
- **sqlite_cache.py**: Кэширование отправленных сигналов для предотвращения дубликатов

## Ключевые компоненты

1. **Конфигурация**:
   - Загружается из YAML-файла (по умолчанию config.yaml)
   - Поддерживает переопределение через переменные окружения
   - Содержит настройки валютных пар, таймфреймов, индикаторов и Telegram-бота

2. **Система получения данных**:
   - Использует Yahoo Finance через библиотеку yfinance
   - Поддерживает множество таймфреймов: 1m, 5m, 15m, 30m, 60m, 1h, 4h, 1d
   - Асинхронная загрузка данных для нескольких валютных пар

3. **Анализатор сигналов**:
   - Рассчитывает технические индикаторы: EMA20/50, MACD, RSI, ADX
   - Обнаруживает тренды, пересечения индикаторов, уровни перекупленности/перепроданности
   - Анализирует уровни классических поворотных точек (pivot levels)
   - Обнаруживает резкие тиковые движения

4. **Система уведомлений**:
   - Отправка сигналов через Telegram-бота
   - Поддержка различных уровней важности сообщений
   - Механизм подавления дубликатов с настраиваемым интервалом

5. **Система кэширования**:
   - Использование SQLite базы данных для хранения истории отправленных сигналов
   - Предотвращение дубликатов с учетом настраиваемого интервала времени
   - Хранение метаданных для обеспечения уникальности уведомлений

### Функциональные возможности

1. **Режим мониторинга**:
   - Постоянный цикл проверки торговых сигналов
   - Параллельный анализ нескольких валютных пар и таймфреймов
   - Настройка интервалов проверки для каждого таймфрейма

2. **Режим бэктеста**:
   - Исторический анализ сигналов на основе прошлых данных
   - Возможность тестирования стратегии на исторических свечах

3. **Уведомления**:
   - Различные типы сигналов: тренд, пересечения MACD, RSI, уровни pivot
   - Резкие тиковые движения
   - Ежечасные уведомления о работе агента

4. **Гибкая конфигурация**:
   - Поддержка различных таймфреймов и валютных пар
   - Настройка порогов индикаторов
   - Возможность настройки интервалов опроса

## Асинхронный агент-оповещатель по форекс-парам

Получает OHLCV данные из Yahoo Finance, анализирует индикаторы (EMA20/50, ADX, MACD, RSI), уровни классических пивотов и отправляет уведомления в Telegram. Не является торговым советником — сообщает о «движении» на рынке.

Стек: Python, asyncio, Pandas, TA-Lib, httpx, SQLite (кеш), Docker, docker-compose.

#### Возможности
- Периодический опрос по заданным таймфреймам и парам.
- Индикаторы: EMA(20/50), ADX(14), MACD(12,26,9), RSI(14).
- Классические пивоты (уровни от предыдущего дня) и уведомления при касании.
- Антиспам: не чаще N минут на событие/пару/таймфрейм (по умолчанию 60 минут), важные события проходят вне очереди.
- Ежечасный «heartbeat» (настраивается).
- Бэктест режима: анализ истории без отправки в Telegram.

#### Конфигурация
Скопируйте и отредактируйте config.yaml. Основные параметры:
- timezone: Europe/Moscow
- pairs: список форекс-символов в формате OANDA:BASE_QUOTE (например, OANDA:EUR_USD). Внутри агент преобразует их в тикеры Yahoo вида BASEQUOTE=X (например, EURUSD=X).
- timeframes: список заданий {timeframe: "5", poll_interval_seconds: 60}
- telegram: bot_token, chat_id, message_cooldown_minutes
- провайдер данных: Yahoo Finance (ключ не требуется)
- пороги ADX и RSI, включение бэктеста, путь к SQLite

Переменные окружения приоритетнее:
- TELEGRAM_BOT_TOKEN
- TELEGRAM_CHAT_ID
- SQLITE_PATH

#### Локальный запуск (без Docker)
1) Python 3.11+
2) Установите зависимости: `pip install .`
3) Запуск агента:
```
forex-signal-agent --config config.yaml
```
4) Бэктест:
```
forex-signal-agent --config config.yaml --backtest
```

#### Docker
Собрать и запустить через docker-compose:
```
export TELEGRAM_BOT_TOKEN=... \
       TELEGRAM_CHAT_ID=...

docker compose up -d --build
```
Логи:
```
docker compose logs -f
```

#### Примечания
- Таймфреймы поддерживаются: 1,5,15,30,60,1h,4h,D (4h формируется ресемплингом из 60m).
- TA-Lib устанавливается из PyPI (доступны колеса для Linux). В Docker образе используется python:3.11-slim.

#### Безопасность
Не храните токены в репозитории. Для секретов используйте переменные окружения или внешние секреты в Docker/Orchestrator.

### Зависимости
- pandas: для работы с финансовыми данными
- yfinance: для получения данных с Yahoo Finance
- TA-Lib: для расчета технических индикаторов
- httpx: для работы с Telegram API
- aiosqlite: для асинхронного доступа к кэшу
- PyYAML: для работы с конфигурационными файлами

### Особенности реализации
- Полностью асинхронная архитектура с использованием asyncio
- Эффективная многозадачность с использованием asyncio.gather
- Механизм дедупликации уведомлений на основе кэширования
- Поддержка нескольких таймфреймов с разными интервалами проверки
- Обработка исключений для обеспечения стабильной работы агента

### Запуск
Агент может быть запущен в двух режимах:
1. Режим мониторинга (по умолчанию): непрерывный анализ и отправка сигналов
2. Режим бэктеста (--backtest): однократный анализ исторических данных

Проект представляет собой надежное решение для автоматического мониторинга рынка Форекс с возможностью быстрой настройки под конкретные торговые стратегии и отправки актуальных сигналов прямо в Telegram.
